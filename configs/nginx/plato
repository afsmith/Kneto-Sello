
upstream plato_gunicorn {
	server unix:/var/run/bls/plato.sock fail_timeout=0;
}

server {

	listen   80;

	server_name  10.4.7.241;

	#
	# Allow uploads up to 100 MB.
	# Nginx caches whole file in memory, so make sure you have plenty.
	#
	client_max_body_size 500m;

	#
	# To enable Basic Auth uncomment the lines below and create
	# basic_auth_passwd file using htpasswd tool.
	#
	# auth_basic            "Restricted";
	# auth_basic_user_file  /etc/opt/bls/plato/basic_auth_passwd;

	access_log  /var/log/bls/plato/nginx.access.log;
	error_log  /var/log/bls/plato/nginx.error.log;

	location / {
		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		proxy_set_header Host $http_host;
		proxy_redirect off;
		proxy_pass http://plato_gunicorn;
	}

	location /reload {
		proxy_set_header   Host             $host;
		proxy_set_header   X-Real-IP        $remote_addr;
		proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
		proxy_pass         http://localhost:8080/reload;
	}

	location /media {
		root /opt/bls/plato/src/webfront;
		autoindex on;
		index off;
	}

	location /admin_media/ {
		alias /opt/bls/plato/ENV/python2.6/site-packages/django/contrib/admin/media/;
	}

        location  /favicon.ico {
                alias /opt/bls/plato/src/webfront/media/img/favicon.png;
        }


	#error_page  404  /404.html;

	# redirect server error pages to the static page /50x.html
	#
	#error_page   500 502 503 504  /50x.html;
	#location = /50x.html {
	#	root   /var/www/nginx-default;
	#}
}

# vim: set noet sw=8 ts=8:
